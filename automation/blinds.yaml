  - alias: 'Blind close at sunset'
    id: blind_sunset
    trigger:
      - platform: sun
        event: sunset
    action:
        - service: cover.close_cover
          data:
            entity_id: cover.blind

  - alias: 'Blind open at sunrise week'
    id: blind_sunrise_week
    trigger:
      - platform: time
        at: '08:00:00'
    condition: 
      - condition: time
        weekday:
          - mon
          - tue
          - wed
          - thu
          - fri
    action:
        - service: cover.open_cover
          data:
            entity_id: cover.blind

  - alias: 'Blind open at sunrise weekend'
    id: blind_sunrise_weekend
    trigger:
      - platform: time
        at: '11:00:00'
    condition: 
      - condition: time
        weekday:
          - sat
          - sun
    action:
        - service: cover.open_cover
          data:
            entity_id: cover.blind

  - alias: 'Close the blind when its sunny'
    id: blind_sunny
    trigger:
      # - platform: time
      #   minutes: '/5'
      #   seconds: 00
      - platform: template
        value_template: >-
              {%- set azimuth = states.sun.sun.attributes.azimuth | float -%}         
              {%- set sun_pos = azimuth > 195 and azimuth < 286 -%}
              {%- set sun_ele = states.sun.sun.attributes.elevation | float > 4 -%}
              {%- set temp = states.sensor.temperature.state | float >= 22 and states.sensor.weather_temperature.state | float >= 19 -%}
              {{ sun_pos and sun_ele and temp and is_state('input_boolean.clear_day', 'on') }}  
    condition: 
      condition: and
      conditions:
      - condition: state
        entity_id: sun.sun
        state: above_horizon
      - condition: time
        after: '11:00:00'
    action:
        - service: cover.set_cover_position
          data_template:
            entity_id: cover.blind
            position: >-
              {%- set elevation = states.sun.sun.attributes.elevation | float -%}
              {%- set azimuth = states.sun.sun.attributes.azimuth | float -%}
              {%- set temp_out = states.sensor.weather_temperature.state | float -%}
              {%- set temp_in = states.sensor.temperature.state | float -%}
              {%- set clear = is_state('input_boolean.clear_day', 'on') -%}
              {%- set add = (temp_in - 22, 1) | max -%}
              {%- set sun_pos = azimuth > 195 and azimuth < 286 -%}
              {%- set sun_ele = elevation > 4 -%}
              {%- set factor = (temp_out - 19, 1) | max -%}
              {%- set temp = temp_in >= 22 and temp_out >= 19 -%}
              {%- if sun_pos and sun_ele and temp and clear -%}
                {{ ([[ elevation - (add*factor) | round | int, 100] |min, 0] |max) | int }}
              {%- else -%}
                100
              {%- endif -%}

  - alias: 'Set Clear Day'
    id: set_clear
    trigger:
      platform: state
      entity_id: sensor.weather_condition
      to: clear
    condition: 
      condition: state
      entity_id: sun.sun
      state: above_horizon
    action:
    - service: input_boolean.turn_on
      data:
        entity_id: input_boolean.clear_day

  - alias: 'Reset Clear Day'
    id: reset_clear
    trigger:
      platform: sun
      event: sunrise
      offset: '-00:05:00'
    action:
    - service: input_boolean.turn_off
      data:
        entity_id: input_boolean.clear_day
    - condition: state
      entity_id: sensor.weather_condition
      state: clear
    - service: input_boolean.turn_on
      data:
        entity_id: input_boolean.clear_day

3T13:02:46.981700+00:00